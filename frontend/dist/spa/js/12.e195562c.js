(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{c244:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("breadcrumb",{attrs:{buttons:"",title:t.$parent.audit.name,id:"edit-breadcrumb-affix"}},[a("div",{attrs:{slot:"buttons"},slot:"buttons"},[a("q-btn",{attrs:{color:"positive",label:"Save (ctrl+s)","no-caps":""},on:{click:t.updateAuditGeneral}})],1)]),a("div",{staticClass:"row q-col-gutter-md q-pa-md"},[a("div",{staticClass:"col-md-8 offset-md-2 col-12"},[a("q-card",{staticClass:"bg-grey-1"},[a("q-card-section",[a("div",{staticClass:"row q-col-gutter-md"},[a("q-input",{staticClass:"col-md-6 col-12",attrs:{label:"Name *",outlined:"","bg-color":"white"},model:{value:t.audit.name,callback:function(e){t.$set(t.audit,"name",e)},expression:"audit.name"}}),a("q-select",{staticClass:"col-md-6 col-12",attrs:{label:"Assessment Type",options:t.auditTypesLang,"option-value":"name","option-label":"name","emit-value":"","map-options":"","options-sanitize":"",outlined:"","bg-color":"white"},model:{value:t.audit.auditType,callback:function(e){t.$set(t.audit,"auditType",e)},expression:"audit.auditType"}}),a("q-select",{staticClass:"col-md-6 col-12",attrs:{label:"Language",options:t.languages,"option-value":"locale","option-label":"language","emit-value":"","map-options":"","options-sanitize":"",outlined:"","bg-color":"white"},model:{value:t.audit.language,callback:function(e){t.$set(t.audit,"language",e)},expression:"audit.language"}}),a("q-select",{staticClass:"col-md-6 col-12",attrs:{label:"Template",options:t.templates,"option-value":"_id","option-label":"name","emit-value":"","map-options":"","options-sanitize":"",outlined:"","bg-color":"white"},model:{value:t.audit.template,callback:function(e){t.$set(t.audit,"template",e)},expression:"audit.template"}})],1)]),a("q-card-section"),a("q-card-section",[a("div",{staticClass:"row q-col-gutter-md"},[a("q-select",{staticClass:"col-md-6 col-12",attrs:{label:"Company",options:t.companies,"option-value":"_id","option-label":"name",clearable:"","options-sanitize":"",outlined:"","bg-color":"white"},on:{input:t.filterClients},model:{value:t.audit.company,callback:function(e){t.$set(t.audit,"company",e)},expression:"audit.company"}}),a("q-select",{staticClass:"col-md-6 col-12",attrs:{label:"Client","stack-label":"",options:t.selectClients,"option-value":"email","option-label":"email",clearable:"","options-sanitize":"",outlined:"","bg-color":"white"},on:{input:t.filterCompany},model:{value:t.audit.client,callback:function(e){t.$set(t.audit,"client",e)},expression:"audit.client"}}),a("q-select",{staticClass:"col-md-12 col-12",attrs:{label:"Collaborators","stack-label":"",options:t.collaborators,"option-value":"username","option-label":function(t){return t.firstname+" "+t.lastname},multiple:"","use-chips":"","options-sanitize":"",outlined:"","bg-color":"white"},scopedSlots:t._u([{key:"after",fn:function(){return[a("q-chip",{staticClass:"q-mt-lg",attrs:{color:"blue-grey-5","text-color":"white",dense:""}},[t._v(t._s(t.audit.creator.firstname)+" "+t._s(t.audit.creator.lastname))])]},proxy:!0},{key:"selected-item",fn:function(e){return[a("q-chip",{attrs:{dense:"",removable:"",tabindex:e.tabindex,color:"blue-grey-5","text-color":"white"},on:{remove:function(t){return e.removeAtIndex(e.index)}}},[t._v("\n                                "+t._s(e.opt.firstname)+" "+t._s(e.opt.lastname)+"\n                            ")])]}}]),model:{value:t.audit.collaborators,callback:function(e){t.$set(t.audit,"collaborators",e)},expression:"audit.collaborators"}})],1)]),a("q-card-section"),a("q-card-section",[a("div",{staticClass:"row q-col-gutter-md"},[a("q-input",{staticClass:"col-md-4 col-12",attrs:{label:"Start Date",outlined:"","bg-color":"white"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateStartProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{"first-day-of-week":"1",mask:"YYYY-MM-DD"},on:{input:function(){return t.$refs.qDateStartProxy.hide()}},model:{value:t.audit.date_start,callback:function(e){t.$set(t.audit,"date_start",e)},expression:"audit.date_start"}})],1)],1)]},proxy:!0}]),model:{value:t.audit.date_start,callback:function(e){t.$set(t.audit,"date_start",e)},expression:"audit.date_start"}}),a("q-input",{staticClass:"col-md-4 col-12",attrs:{label:"End Date",outlined:"","bg-color":"white"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateEndProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{"first-day-of-week":"1",mask:"YYYY-MM-DD"},on:{input:function(){return t.$refs.qDateEndProxy.hide()}},model:{value:t.audit.date_end,callback:function(e){t.$set(t.audit,"date_end",e)},expression:"audit.date_end"}})],1)],1)]},proxy:!0}]),model:{value:t.audit.date_end,callback:function(e){t.$set(t.audit,"date_end",e)},expression:"audit.date_end"}}),a("q-input",{staticClass:"col-md-4 col-12",attrs:{label:"Reporting Date",outlined:"","bg-color":"white"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{attrs:{"first-day-of-week":"1",mask:"YYYY-MM-DD"},on:{input:function(){return t.$refs.qDateProxy.hide()}},model:{value:t.audit.date,callback:function(e){t.$set(t.audit,"date",e)},expression:"audit.date"}})],1)],1)]},proxy:!0}]),model:{value:t.audit.date,callback:function(e){t.$set(t.audit,"date",e)},expression:"audit.date"}})],1)]),a("q-card-section",[a("textarea-array",{attrs:{label:"Scope (One per line)","no-empty-line":""},model:{value:t.audit.scope,callback:function(e){t.$set(t.audit,"scope",e)},expression:"audit.scope"}})],1),t.audit.customFields&&t.audit.customFields.length>0?a("q-expansion-item",{attrs:{label:"Custom Fields","default-opened":"","header-class":"bg-blue-grey-5 text-white","expand-icon-class":"text-white"}},[a("custom-fields",{ref:"customfields",attrs:{"custom-element":"QCardSection","no-sync-editor":""},model:{value:t.audit.customFields,callback:function(e){t.$set(t.audit,"customFields",e)},expression:"audit.customFields"}})],1):t._e()],1)],1)])],1)},o=[],s=(a("4de4"),a("ac1f"),a("466d"),a("d81d"),a("b0c0"),a("2a19")),n=a("436b"),l=a("b3a4"),c=a("78af"),u=a("81ab"),r=a("99ec"),d=a("872f"),p=a("e3fa"),m=a("a3d7"),f=a("b0f9"),g=a("ed8e"),h=a("6fbe"),b={data:function(){return{auditId:null,audit:{creator:{},name:"",location:"",auditType:"",client:{},company:{},collaborators:[],date:"",date_start:"",date_end:"",scope:[],language:"",template:"",customFields:[]},auditOrig:{},clients:[],selectClients:[],collaborators:[],companies:[],templates:[],languages:[],auditTypes:[],customFields:[]}},components:{Breadcrumb:l["a"],TextareaArray:c["a"],CustomFields:u["a"]},mounted:function(){this.auditId=this.$route.params.auditId,this.getAuditGeneral(),this.getClients(),this.getTemplates(),this.getLanguages(),this.getAuditTypes(),this.$socket.emit("menu",{menu:"general",room:this.auditId}),document.addEventListener("keydown",this._listener,!1)},destroyed:function(){document.removeEventListener("keydown",this._listener,!1)},beforeRouteLeave:function(t,e,a){h["a"].syncEditors(this.$refs),this.$_.isEqual(this.audit,this.auditOrig)?a():n["a"].create({title:"There are unsaved changes !",message:"Do you really want to leave ?",ok:{label:"Confirm",color:"negative"},cancel:{label:"Cancel",color:"white"}}).onOk((function(){return a()}))},computed:{auditTypesLang:function(){var t=this;return this.auditTypes.filter((function(e){return e.locale===t.audit.language}))}},methods:{_listener:function(t){(window.navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&83==t.keyCode&&(t.preventDefault(),this.updateAuditGeneral())},getAuditGeneral:function(){var t=this;g["a"].getCustomFields().then((function(e){return t.customFields=e.data.datas,r["a"].getAuditGeneral(t.auditId)})).then((function(e){t.audit=e.data.datas,t.audit.customFields=h["a"].filterCustomFields("audit-general","",t.customFields,t.audit.customFields),t.auditOrig=t.$_.cloneDeep(t.audit),t.getCollaborators()})).catch((function(t){console.log(t.response)}))},updateAuditGeneral:function(){var t=this;h["a"].syncEditors(this.$refs),this.$nextTick((function(){t.$refs.customfields&&t.$refs.customfields.requiredFieldsEmpty()?s["a"].create({message:"Please fill all required Fields",color:"negative",textColor:"white",position:"top-right"}):r["a"].updateAuditGeneral(t.auditId,t.audit).then((function(){t.auditOrig=t.$_.cloneDeep(t.audit),s["a"].create({message:"Audit updated successfully",color:"positive",textColor:"white",position:"top-right"})})).catch((function(t){s["a"].create({message:t.response.data.datas,color:"negative",textColor:"white",position:"top-right"})}))}))},getClients:function(){var t=this;d["a"].getClients().then((function(e){t.clients=e.data.datas,t.selectClients=t.clients,t.getCompanies()})).catch((function(t){console.log(t)}))},getCompanies:function(){var t=this;p["a"].getCompanies().then((function(e){t.companies=e.data.datas,t.filterClients()})).catch((function(t){console.log(t)}))},getCollaborators:function(){var t=this;m["a"].getCollabs().then((function(e){var a="";t.audit.creator&&(a=t.audit.creator._id),t.collaborators=e.data.datas.filter((function(t){return t._id!==a}))})).catch((function(t){console.log(t)}))},getTemplates:function(){var t=this;f["a"].getTemplates().then((function(e){t.templates=e.data.datas})).catch((function(t){console.log(t)}))},getLanguages:function(){var t=this;g["a"].getLanguages().then((function(e){t.languages=e.data.datas})).catch((function(t){console.log(t)}))},getAuditTypes:function(){var t=this;g["a"].getAuditTypes().then((function(e){t.auditTypes=e.data.datas})).catch((function(t){console.log(t)}))},filterClients:function(t){var e=this;this.audit.company?(this.selectClients=[],this.clients.map((function(t){t.company&&t.company.name===e.audit.company.name&&e.selectClients.push(t)}))):this.selectClients=this.clients},filterCompany:function(t){if(t&&!t.company)this.audit.company={};else if(t)for(var e=0;e<this.companies.length;e++)if(this.companies[e].name===t.company.name){this.audit.company=this.companies[e];break}}}},y=b,v=a("2877"),C=Object(v["a"])(y,i,o,!1,null,null,null);e["default"]=C.exports}}]);