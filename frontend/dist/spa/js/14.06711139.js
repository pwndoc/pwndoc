(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{"53a1":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("breadcrumb",{attrs:{buttons:"",title:t.$parent.audit.name}},[n("div",{attrs:{slot:"buttons"},slot:"buttons"},[n("q-btn",{staticClass:"q-mr-sm",attrs:{color:"negative",label:"Delete","no-caps":""},on:{click:t.deleteSection}}),n("q-btn",{attrs:{color:"positive",label:"Save (ctrl+s)","no-caps":""},on:{click:t.updateSection}})],1)]),n("div",{staticClass:"row q-col-gutter-md q-pa-md"},[n("div",{staticClass:"col-md-8 offset-md-2"},[n("q-card",{staticClass:"affix-relative-element bg-grey-1"},[n("q-card-section",[n("basic-editor",{ref:"basiceditor_section",attrs:{noSync:"",affix:""},model:{value:t.section.text,callback:function(e){t.$set(t.section,"text",e)},expression:"section.text"}})],1)],1)],1)])],1)},o=[],a=(n("ac1f"),n("466d"),n("c740"),n("99af"),n("2a19")),s=n("436b"),c=n("a897"),r=n("b3a4"),d=n("99ec"),l=n("6fbe"),u={data:function(){return{auditId:null,section:{},sectionOrig:{}}},components:{BasicEditor:c["a"],Breadcrumb:r["a"]},mounted:function(){this.auditId=this.$route.params.auditId,this.sectionId=this.$route.params.sectionId,this.getSection(),this.$socket.emit("menu",{menu:"editSection",section:this.sectionId,room:this.auditId}),document.addEventListener("keydown",this._listener,!1)},destroyed:function(){document.removeEventListener("keydown",this._listener,!1)},beforeRouteLeave:function(t,e,n){l["a"].syncEditors(this.$refs),this.unsavedChanges()?s["a"].create({title:"There are unsaved changes !",message:"Do you really want to leave ?",ok:{label:"Confirm",color:"negative"},cancel:{label:"Cancel",color:"white"}}).onOk((function(){return n()})):n()},beforeRouteUpdate:function(t,e,n){l["a"].syncEditors(this.$refs),this.unsavedChanges()?s["a"].create({title:"There are unsaved changes !",message:"Do you really want to leave ?",ok:{label:"Confirm",color:"negative"},cancel:{label:"Cancel",color:"white"}}).onOk((function(){return n()})):n()},methods:{_listener:function(t){(window.navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&83==t.keyCode&&(t.preventDefault(),this.updateSection())},getSection:function(){var t=this;d["a"].getSection(this.auditId,this.sectionId).then((function(e){t.section=e.data.datas,t.$nextTick((function(){l["a"].syncEditors(t.$refs),t.sectionOrig=t.$_.cloneDeep(t.section)}))})).catch((function(t){console.log(t)}))},updateSection:function(){var t=this;l["a"].syncEditors(this.$refs),d["a"].updateSection(this.auditId,this.sectionId,this.section).then((function(){t.sectionOrig=t.$_.cloneDeep(t.section),a["a"].create({message:"Section updated successfully",color:"positive",textColor:"white",position:"top-right"})})).catch((function(t){a["a"].create({message:t.response.data.datas,color:"negative",textColor:"white",position:"top-right"})}))},deleteSection:function(){var t=this;s["a"].create({title:"Delete current Section ?",message:"This action can't be cancelled",ok:{label:"Confirm",color:"negative"},cancel:{label:"Cancel",color:"white"}}).onOk((function(){d["a"].deleteSection(t.auditId,t.sectionId).then((function(){a["a"].create({message:"Section deleted successfully",color:"positive",textColor:"white",position:"top-right"}),t.sectionOrig=t.section;var e=t.$parent.audit.sections.findIndex((function(e){return e._id===t.sectionId}));1===t.$parent.audit.sections.length?t.$router.push("/audits/".concat(t.$parent.auditId,"/general")):e===t.$parent.audit.sections.length-1?t.$router.push("/audits/".concat(t.$parent.auditId,"/sections/").concat(t.$parent.audit.sections[e-1]._id)):t.$router.push("/audits/".concat(t.$parent.auditId,"/sections/").concat(t.$parent.audit.sections[e+1]._id))})).catch((function(t){a["a"].create({message:t.response.data.datas,color:"negative",textColor:"white",position:"top-right"})}))}))},unsavedChanges:function(){return!(!this.section.text&&!this.sectionOrig.text||this.section.text===this.sectionOrig.text)}}},h=u,f=n("2877"),p=Object(f["a"])(h,i,o,!1,null,null,null);e["default"]=p.exports}}]);