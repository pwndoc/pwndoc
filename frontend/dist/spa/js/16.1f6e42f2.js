(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"13f5":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"row"},[0===e.languages.length?a("div",{staticClass:"col-md-4 offset-md-4 q-mt-md"},[e._m(0)]):e._e(),0===e.templates.length?a("div",{staticClass:"col-md-4 offset-md-4 q-mt-md"},[e._m(1)]):e._e(),e.languages.length>0&&e.templates.length>0?a("div",{staticClass:"col-md-8 col-12 offset-md-2 q-mt-md"},[a("q-table",{staticClass:"sticky-header-table",attrs:{"card-class":"bg-grey-1","table-header-class":"bg-grey-1",columns:e.dtHeaders,"visible-columns":e.visibleColumns,data:e.audits,filter:e.search,"filter-method":e.customFilter,pagination:e.pagination,"row-key":"_id",separator:"none",loading:e.loading},on:{"update:pagination":function(t){e.pagination=t},"row-dblclick":e.dblClick},scopedSlots:e._u([{key:"top",fn:function(){return[a("q-input",{staticClass:"col-md-3",attrs:{color:"secondary",label:"Search Finding",outlined:"","bg-color":"white"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getAudits(t)}},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-btn",{attrs:{flat:"",icon:"search"},on:{click:e.getAudits}}),e.search.finding?a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"cancel"},on:{click:function(t){t.stopPropagation(),e.search.finding=null,e.getAudits()}}}):e._e()]},proxy:!0}],null,!1,2521165817),model:{value:e.search.finding,callback:function(t){e.$set(e.search,"finding",t)},expression:"search.finding"}}),a("q-toggle",{attrs:{label:"My Audits"},model:{value:e.myAudits,callback:function(t){e.myAudits=t},expression:"myAudits"}}),e.UserService.isAllowed("audits:users-connected")?a("q-toggle",{attrs:{label:"Users Connected"},model:{value:e.displayConnected,callback:function(t){e.displayConnected=t},expression:"displayConnected"}}):e._e(),a("q-space"),a("q-btn",{attrs:{color:"secondary",unelevated:"",label:"New Audit","no-caps":""},on:{click:function(t){e.cleanCurrentAudit(),e.$refs.createModal.show()}}})]},proxy:!0},{key:"top-row",fn:function(t){return[a("q-tr",e._l(t.cols,(function(t){return a("q-td",{key:t.name,staticStyle:{width:"20%"}},[["name","users","date"].indexOf(t.name)>-1?a("div",[a("q-input",{attrs:{dense:"",color:"secondary",label:"Search...",clearable:"",autofocus:"name"===t.name,outlined:"","bg-color":"white"},model:{value:e.search[t.name],callback:function(a){e.$set(e.search,t.name,a)},expression:"search[col.name]"}})],1):"company"===t.name?a("div",[a("q-select",{attrs:{dense:"",color:"secondary",label:"Search...",options:e.companies,"option-value":"name","option-label":"name","map-options":"","emit-value":"",clearable:"","options-sanitize":"",outlined:"","bg-color":"white"},model:{value:e.search.company,callback:function(t){e.$set(e.search,"company",t)},expression:"search.company"}})],1):"language"===t.name?a("div",[a("q-select",{attrs:{dense:"",color:"secondary",label:"Search...",options:e.languages,"option-value":"locale","option-label":"language","map-options":"","emit-value":"",clearable:"","options-sanitize":"",outlined:"","bg-color":"white"},model:{value:e.search.language,callback:function(t){e.$set(e.search,"language",t)},expression:"search.language"}})],1):e._e()])})),1)]}},{key:"body-cell-language",fn:function(t){return a("q-td",{},[e._v("\n                "+e._s(e.convertLocale(t.row.language))+"\n            ")])}},{key:"body-cell-users",fn:function(t){return a("q-td",{},[e._v("\n                "+e._s(e.convertParticipants(t.row))+"\n            ")])}},{key:"body-cell-connected",fn:function(t){return a("q-td",{},[e.UserService.isAllowed("audits:users-connected")&&t.row.connected&&t.row.connected.length>0?a("q-chip",{attrs:{square:"",dense:""}},[a("q-avatar",{attrs:{color:"green","text-color":"white"}},[e._v(e._s(t.row.connected.length))]),e._v("\n                    Users\n                    "),a("q-tooltip",{attrs:{anchor:"bottom middle",self:"center left",delay:500,"content-class":"text-bold"}},[e._v("\n                        "+e._s(t.row.connected.join(", "))+"\n                    ")])],1):e._e()],1)}},{key:"body-cell-action",fn:function(t){return a("q-td",{staticStyle:{width:"1px"}},[a("q-btn",{attrs:{size:"sm",flat:"",color:"primary",to:"/audits/"+t.row._id,icon:"fa fa-edit"}},[a("q-tooltip",{attrs:{anchor:"bottom middle",self:"center left",delay:500,"content-class":"text-bold"}},[e._v("Edit Audit")])],1),a("q-btn",{attrs:{size:"sm",flat:"",color:"info",icon:"fa fa-download"},on:{click:function(a){return e.generateReport(t.row._id)}}},[a("q-tooltip",{attrs:{anchor:"bottom middle",self:"center left",delay:500,"content-class":"text-bold"}},[e._v("Download Report")])],1),a("q-btn",{attrs:{size:"sm",flat:"",color:"negative",icon:"fa fa-trash"},on:{click:function(a){return e.confirmDeleteAudit(t.row)}}},[a("q-tooltip",{attrs:{anchor:"bottom middle",self:"center left",delay:500,"content-class":"text-bold"}},[e._v("Delete Audit")])],1)],1)}},{key:"bottom",fn:function(t){return[1===e.audits.length?a("span",[e._v("1 Audit")]):a("span",[e._v(e._s(e.audits.length)+" Audits")]),a("q-space"),a("span",[e._v("Results per page:")]),a("q-select",{staticClass:"q-px-md",attrs:{options:e.rowsPerPageOptions,"emit-value":"","map-options":"",dense:"","options-dense":"","options-cover":"",borderless:""},model:{value:e.pagination.rowsPerPage,callback:function(t){e.$set(e.pagination,"rowsPerPage",t)},expression:"pagination.rowsPerPage"}}),a("q-pagination",{attrs:{input:"",max:t.pagesNumber},model:{value:e.pagination.page,callback:function(t){e.$set(e.pagination,"page",t)},expression:"pagination.page"}})]}}],null,!1,3790739191)})],1):e._e()]),a("q-dialog",{ref:"createModal",attrs:{persistent:""},on:{hide:function(t){return e.cleanCurrentAudit()}}},[a("q-card",{staticStyle:{width:"800px"}},[a("q-bar",{staticClass:"bg-primary text-white"},[a("div",{staticClass:"q-toolbar-title"},[e._v("\n                Create Audit\n            ")]),a("q-space"),a("q-btn",{attrs:{dense:"",flat:"",icon:"close"},on:{click:function(t){return e.$refs.createModal.hide()}}})],1),a("q-card-section",[a("q-input",{attrs:{label:"Name *",error:!!e.errors.name,"error-message":e.errors.name,autofocus:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.createAudit()}},model:{value:e.currentAudit.name,callback:function(t){e.$set(e.currentAudit,"name",t)},expression:"currentAudit.name"}}),a("q-select",{attrs:{label:"Select Language *",error:!!e.errors.language,"error-message":e.errors.language,options:e.languages,"option-value":"locale","option-label":"language","emit-value":"","map-options":"","options-sanitize":""},model:{value:e.currentAudit.language,callback:function(t){e.$set(e.currentAudit,"language",t)},expression:"currentAudit.language"}}),a("q-select",{attrs:{label:"Select Template *",error:!!e.errors.template,"error-message":e.errors.template,options:e.templates,"option-value":"_id","option-label":"name","emit-value":"","map-options":"","options-sanitize":""},model:{value:e.currentAudit.template,callback:function(t){e.$set(e.currentAudit,"template",t)},expression:"currentAudit.template"}})],1),a("q-separator"),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary",outline:""},on:{click:function(t){return e.$refs.createModal.hide()}}},[e._v("Cancel")]),a("q-btn",{attrs:{color:"secondary",unelevated:""},on:{click:function(t){return e.createAudit()}}},[e._v("Create")])],1)],1)],1)],1)},o=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[e._v("No languages are defined. "),a("br"),e._v(" Please create Languages in "),a("a",{attrs:{href:"/datas/custom"}},[e._v("Datas -> Custom Datas -> Languages")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[e._v("No templates are defined. "),a("br"),e._v(" Please create Templates in "),a("a",{attrs:{href:"/datas/templates"}},[e._v("Datas -> Templates")])])}],r=a("c973"),s=a.n(r),i=(a("96cf"),a("b0c0"),a("ac1f"),a("1276"),a("841c"),a("d3b7"),a("e6cf"),a("e260"),a("3ca3"),a("ddb0"),a("2b3d"),a("159b"),a("a15b"),a("5319"),a("4de4"),a("436b")),l=a("2a19"),c=a("b3a4"),u=a("99ec"),d=a("ed8e"),g=a("b0f9"),p=a("e3fa"),m=a("93d6"),f={data:function(){return{UserService:m["a"],audits:[],loading:!0,templates:[],companies:[],languages:[],dtHeaders:[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"language",label:"Language",field:"language",align:"left",sortable:!0},{name:"company",label:"Company",field:function(e){return e.company?e.company.name:""},align:"left",sortable:!0},{name:"users",label:"Participants",align:"left",sortable:!0},{name:"date",label:"Date",field:function(e){return e.createdAt.split("T")[0]},align:"left",sortable:!0},{name:"connected",label:"",align:"left",sortable:!1},{name:"action",label:"",field:"action",align:"left",sortable:!1}],visibleColumns:["name","language","company","users","date","action"],pagination:{page:1,rowsPerPage:25,sortBy:"date",descending:!0},rowsPerPageOptions:[{label:"25",value:25},{label:"50",value:50},{label:"100",value:100},{label:"All",value:0}],search:{finding:"",name:"",language:"",company:"",users:"",date:""},myAudits:!1,displayConnected:!1,errors:{name:"",language:"",template:""},currentAudit:{name:"",language:"",template:""}}},components:{Breadcrumb:c["a"]},mounted:function(){this.search.finding=this.$route.params.finding,this.UserService.isAllowed("audits:users-connected")&&(this.visibleColumns=["name","language","company","users","date","connected","action"]),this.getAudits(),this.getLanguages(),this.getTemplates(),this.getCompanies()},methods:{getLanguages:function(){var e=this;d["a"].getLanguages().then((function(t){e.languages=t.data.datas})).catch((function(e){console.log(e)}))},getTemplates:function(){var e=this;g["a"].getTemplates().then((function(t){e.templates=t.data.datas})).catch((function(e){console.log(e)}))},getCompanies:function(){var e=this;p["a"].getCompanies().then((function(t){e.companies=t.data.datas})).catch((function(e){console.log(e)}))},getAudits:function(){var e=this;this.loading=!0,u["a"].getAudits({findingTitle:this.search.finding}).then((function(t){e.audits=t.data.datas,e.loading=!1})).catch((function(e){console.log(e)}))},createAudit:function(){var e=this;this.cleanErrors(),this.currentAudit.name||(this.errors.name="Name required"),this.currentAudit.language||(this.errors.language="Language required"),this.currentAudit.template||(this.errors.template="Template required"),this.errors.name||this.errors.language||this.errors.template||u["a"].createAudit(this.currentAudit).then((function(t){e.$refs.createModal.hide(),e.$router.push("/audits/"+t.data.datas.audit._id)})).catch((function(e){l["a"].create({message:e.response.data.datas,color:"negative",textColor:"white",position:"top-right"})}))},deleteAudit:function(e){var t=this;u["a"].deleteAudit(e).then((function(){t.getAudits(),l["a"].create({message:"Audit deleted successfully",color:"positive",textColor:"white",position:"top-right"})})).catch((function(e){l["a"].create({message:e.response.data.datas,color:"negative",textColor:"white",position:"top-right"})}))},confirmDeleteAudit:function(e){var t=this;i["a"].create({title:"Confirm Suppression",message:"Audit «".concat(e.name,"» will be permanently deleted"),ok:{label:"Confirm",color:"negative"},cancel:{label:"Cancel",color:"white"}}).onOk((function(){return t.deleteAudit(e._id)}))},BlobReader:function(e){var t=new FileReader;return new Promise((function(a,n){t.onerror=function(){t.abort(),n(new Error("Problem parsing blob"))},t.onload=function(){a(t.result)},t.readAsText(e)}))},generateReport:function(e){var t=this;u["a"].generateAuditReport(e).then((function(e){var t=new Blob([e.data],{type:"application/octet-stream"}),a=document.createElement("a");a.href=window.URL.createObjectURL(t),a.download=e.headers["content-disposition"].split('"')[1],document.body.appendChild(a),a.click(),a.remove()})).catch(function(){var e=s()(regeneratorRuntime.mark((function e(a){var n,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n="Error generating template",!a.response||!a.response.data){e.next=7;break}return o=new Blob([a.response.data],{type:"application/json"}),e.next=5,t.BlobReader(o);case 5:r=e.sent,n=JSON.parse(r).datas;case 7:l["a"].create({message:n,type:"negative",textColor:"white",position:"top",closeBtn:!0,timeout:0,classes:"text-pre-wrap"});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},cleanErrors:function(){this.errors.name="",this.errors.language="",this.errors.template=""},cleanCurrentAudit:function(){this.cleanErrors(),this.currentAudit.name="",this.currentAudit.language="",this.currentAudit.template=""},convertLocale:function(e){for(var t=0;t<this.languages.length;t++)if(this.languages[t].locale===e)return this.languages[t].language;return""},convertParticipants:function(e){var t=e.collaborators?e.collaborators:[],a=e.creator?[e.creator.username]:[];return t.forEach((function(e){return a.push(e.username)})),a.join(", ")},customFilter:function(e,t,a,n){var o=this,r=this.UserService.user.username.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e&&e.filter((function(e){var a=(e.name||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),n=(t.name||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=e.language?o.convertLocale(e.language).toLowerCase():"",i=t.language?t.language.toLowerCase():"",l=e.company?e.company.name.toLowerCase():"",c=t.company?t.company.toLowerCase():"",u=o.convertParticipants(e).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),d=(t.users||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),g=e.createdAt?e.createdAt.split("T")[0]:"",p=t.date?t.date.toLowerCase():"";return a.indexOf(n)>-1&&s.indexOf(i)>-1&&l.indexOf(c)>-1&&u.indexOf(d)>-1&&g.indexOf(p)>-1&&(o.myAudits&&u.indexOf(r)>-1||!o.myAudits)&&(o.displayConnected&&e.connected&&e.connected.length>0||!o.displayConnected)}))},dblClick:function(e,t){this.$router.push("/audits/"+t._id)}}},h=f,b=a("2877"),v=Object(b["a"])(h,n,o,!1,null,null,null);t["default"]=v.exports}}]);